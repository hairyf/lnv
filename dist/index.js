#!/usr/bin/env node
var N=Object.create;var y=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var I=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,P=Object.prototype.hasOwnProperty;var V=(e,n,s,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of I(n))!P.call(e,i)&&i!==s&&y(e,i,{get:()=>n[i],enumerable:!(t=F(n,i))||t.enumerable});return e};var a=(e,n,s)=>(s=e!=null?N(K(e)):{},V(n||!e||!e.__esModule?y(s,"default",{value:e,enumerable:!0}):s,e));var c=a(require("pathe")),u=a(require("fs")),g=require("dotenv"),h=require("@manypkg/get-packages"),d=process.cwd();function f(e){return(0,g.config)({processEnv:{},path:p(e)}).parsed?.DOTENV_KEY}function p(e){let n=d;for(;n!==c.default.parse(n).root;){let s=c.default.join(n,e);if(u.default.existsSync(s))return s;n=c.default.dirname(n)}}function x(e,n={}){let t=["# This file is generated by lnv command","# DO NOT ATTEMPT TO EDIT THIS FILE",Object.entries(n).map(([i,o])=>`${i}=${o}`).join(`
`)].join(`
`);u.default.writeFileSync(e,t,"utf-8")}async function w(e={}){let{packages:n}=await(0,h.getPackages)(process.cwd());for(let s of n)console.log(` - ${c.default.relative(d,s.dir)}/.env`),x(`${s.dir}/.env`,e)}async function E(e={}){x(`${d}/.env`,e)}function b(e){let n=[],s="",t=!1,i="";for(let o of e)o.startsWith("'")||o.startsWith("`")?t?s+=" "+o.slice(1):(t=!0,i=o[0],s+=o.slice(1)):o.endsWith("'")||o.endsWith("`")?t&&i===o[o.length-1]?(s+=" "+o.slice(0,-1),n.push(s.trim()),s="",t=!1):n.push(o):t?s+=" "+o:n.push(o);return s&&n.push(s.trim()),n}var k=a(require("yargs")),$=require("yargs/helpers");var T="3.6.0";function O(){return(0,k.default)(b((0,$.hideBin)(process.argv))).scriptName("lnv").showHelpOnFail(!1).version(T).usage("$0 <mode> [args]").alias("h","help").alias("v","version").option("run",{describe:"load runtime environment and run any scripts",type:"array",alias:"r"}).option("monorepo",{describe:"apply to packages in the monorepo.",type:"boolean",alias:"m"}).option("expose",{describe:"expose environment variables",alias:"e",type:"boolean"}).help().parse()}var v=require("dotenv"),D=require("child_process"),r=O();if(!r.monorepo&&!r._[0])throw new Error("Please enter lnv <mode> the loading mode");var m=r._[0]==="dotenv",S=r._[0],l=m?".env.vault":S?`.env.${S}`:".env",Y=r.monorepo?w:E,j=r.expose?r.monorepo?"packages by":".env":"runtime environment",_=m?`Successfully decrypted ${l} to ${j}`:`Successfully loaded ${l} to ${j}`;r.run?.length&&(_+=`
`);async function A(){let e=m?R():Q();e.error?console.log(`Failed to load ${l}, searched upwards, but the file was not found`):console.log(_),r.run&&await C(r.run,e.parsed),r.expose&&await Y(e.parsed)}A();function Q(){return(0,v.config)({path:p(l)})}function R(){let e=f(".env.key")||process.env.DOTENV_KEY||f(".env");if(!e)throw new Error("no DOTENV_KEY found in .env | .env.key or process.env");return(0,v.config)({DOTENV_KEY:e,path:p(".env.vault")})}async function C(e,n){Array.isArray(e)&&(e=e.join(" "));let s={stdio:"inherit",env:{...process.env,...n}};try{let{execaSync:t}=await import("execa");t(e,s)}catch{(0,D.execSync)(e,s)}}
